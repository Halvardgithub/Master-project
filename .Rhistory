labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1_3tau",size = 5)
#make all the three plots together
#RMSE
RMSE1 <- sqrt(mean((DR20_24$death_rate - res_RW1$summary.fitted.values$mean)**2))
RMSE2 <- sqrt(mean((DR20_24$death_rate - res_ARW1$summary.fitted.values$mean)**2))
RMSE3 <- sqrt(mean((DR20_24$death_rate - res_ARW1_3tau$summary.fitted.values$mean)**2))
RMSE <- c(RMSE1, RMSE2, RMSE3)
LS1 <- -mean(log(res_RW1$cpo$cpo))
LS2 <- -mean(log(res_ARW1$cpo$cpo))
LS3 <- -mean(log(res_ARW1_3tau$cpo$cpo))
LS <- c(LS1, LS2, LS3)
data <- data.frame(Method = c("RW1", "ARW1", "ARW1_3tau"), RMSE = RMSE, LS = LS)
ss <- tableGrob(data)
result_plot <- grid.arrange(plot_20_RW1, plot_20_ARW1, plot_20_ARW1_3tau, ss, nrow = 2, top = "With P = 10^7 and PC")
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/res_P10^7_PC.pdf", plot = result_plot, height = 6, width = 8, units = "in")
# Defining the model
DR20_24$us <- 1:N #adding columns for the latent models
DR20_24$time <- 1:N
P <- 100000
prior_str <- "PC" #other alternatives are Gamma0,005 and Gamma0,00005 and PC
if(prior_str == "Gamma0,00005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1")  + f(us, model = "iid")
} else if(prior_str == "Gamma0,005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "loggamma", param = c(1, 0.005))))  + f(us, model = "iid")
} else{
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "pc.prec", param = c(1, 0.01))))  + f(us, model = "iid")
}
res_RW1 <- inla(formula_RW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_RW1)
```
ARW1 <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model,
N = N, conflict_years = S, prior_str = prior_str)
formula_ARW1 <- death_rate ~ f(time, model = ARW1, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1 <- inla(formula_ARW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
ARW1_3tau <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model_3tau,
N = N, conflict_years1 = S_flu, conflict_years2 = S_WW2, prior_str = prior_str)
formula_ARW1_3tau <- death_rate ~ f(time, model = ARW1_3tau, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1_3tau <- inla(formula_ARW1_3tau, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1_3tau)
#plotting
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_RW1$summary.fitted.values$mean))
plot_20_RW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "RW1",size = 5)
#de to er like
#res_RW1$summary.fitted.values$mean
#res_RW1$summary.linear.predictor$mean
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1$summary.fitted.values$mean))
plot_20_ARW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1",size = 5)
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1_3tau$summary.fitted.values$mean))
plot_20_ARW1_3tau <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1_3tau",size = 5)
#make all the three plots together
#RMSE
RMSE1 <- sqrt(mean((DR20_24$death_rate - res_RW1$summary.fitted.values$mean)**2))
RMSE2 <- sqrt(mean((DR20_24$death_rate - res_ARW1$summary.fitted.values$mean)**2))
RMSE3 <- sqrt(mean((DR20_24$death_rate - res_ARW1_3tau$summary.fitted.values$mean)**2))
RMSE <- c(RMSE1, RMSE2, RMSE3)
LS1 <- -mean(log(res_RW1$cpo$cpo))
LS2 <- -mean(log(res_ARW1$cpo$cpo))
LS3 <- -mean(log(res_ARW1_3tau$cpo$cpo))
LS <- c(LS1, LS2, LS3)
data <- data.frame(Method = c("RW1", "ARW1", "ARW1_3tau"), RMSE = RMSE, LS = LS)
ss <- tableGrob(data)
result_plot <- grid.arrange(plot_20_RW1, plot_20_ARW1, plot_20_ARW1_3tau, ss, nrow = 2, top = "With P = 10^5 and PC")
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/res_P10^5_PC.pdf", plot = result_plot, height = 6, width = 8, units = "in")
# Defining the model
DR20_24$us <- 1:N #adding columns for the latent models
DR20_24$time <- 1:N
P <- 100000
prior_str <- "Gamma0,005" #other alternatives are Gamma0,005 and Gamma0,00005 and PC
if(prior_str == "Gamma0,00005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1")  + f(us, model = "iid")
} else if(prior_str == "Gamma0,005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "loggamma", param = c(1, 0.005))))  + f(us, model = "iid")
} else{
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "pc.prec", param = c(1, 0.01))))  + f(us, model = "iid")
}
res_RW1 <- inla(formula_RW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_RW1)
ARW1 <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model,
N = N, conflict_years = S, prior_str = prior_str)
formula_ARW1 <- death_rate ~ f(time, model = ARW1, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1 <- inla(formula_ARW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1)
ARW1_3tau <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model_3tau,
N = N, conflict_years1 = S_flu, conflict_years2 = S_WW2, prior_str = prior_str)
formula_ARW1_3tau <- death_rate ~ f(time, model = ARW1_3tau, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1_3tau <- inla(formula_ARW1_3tau, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1_3tau)
#plotting
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_RW1$summary.fitted.values$mean))
plot_20_RW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "RW1",size = 5)
#de to er like
#res_RW1$summary.fitted.values$mean
#res_RW1$summary.linear.predictor$mean
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1$summary.fitted.values$mean))
plot_20_ARW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1",size = 5)
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1_3tau$summary.fitted.values$mean))
plot_20_ARW1_3tau <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1_3tau",size = 5)
#make all the three plots together
#RMSE
RMSE1 <- sqrt(mean((DR20_24$death_rate - res_RW1$summary.fitted.values$mean)**2))
RMSE2 <- sqrt(mean((DR20_24$death_rate - res_ARW1$summary.fitted.values$mean)**2))
RMSE3 <- sqrt(mean((DR20_24$death_rate - res_ARW1_3tau$summary.fitted.values$mean)**2))
RMSE <- c(RMSE1, RMSE2, RMSE3)
LS1 <- -mean(log(res_RW1$cpo$cpo))
LS2 <- -mean(log(res_ARW1$cpo$cpo))
LS3 <- -mean(log(res_ARW1_3tau$cpo$cpo))
LS <- c(LS1, LS2, LS3)
data <- data.frame(Method = c("RW1", "ARW1", "ARW1_3tau"), RMSE = RMSE, LS = LS)
ss <- tableGrob(data)
result_plot <- grid.arrange(plot_20_RW1, plot_20_ARW1, plot_20_ARW1_3tau, ss, nrow = 2, top = "With P = 10^5 and Gamma(1, 0.005)")
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/res_P10^5_Gamma0.005.pdf", plot = result_plot, height = 6, width = 8, units = "in")
# Defining the model
DR20_24$us <- 1:N #adding columns for the latent models
DR20_24$time <- 1:N
P <- 100000
prior_str <- "Gamma0,00005" #other alternatives are Gamma0,005 and Gamma0,00005 and PC
if(prior_str == "Gamma0,00005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1")  + f(us, model = "iid")
} else if(prior_str == "Gamma0,005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "loggamma", param = c(1, 0.005))))  + f(us, model = "iid")
} else{
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "pc.prec", param = c(1, 0.01))))  + f(us, model = "iid")
}
res_RW1 <- inla(formula_RW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_RW1)
ARW1 <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model,
N = N, conflict_years = S, prior_str = prior_str)
formula_ARW1 <- death_rate ~ f(time, model = ARW1, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1 <- inla(formula_ARW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1)
ARW1_3tau <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model_3tau,
N = N, conflict_years1 = S_flu, conflict_years2 = S_WW2, prior_str = prior_str)
formula_ARW1_3tau <- death_rate ~ f(time, model = ARW1_3tau, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1_3tau <- inla(formula_ARW1_3tau, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1_3tau)
#plotting
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_RW1$summary.fitted.values$mean))
plot_20_RW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "RW1",size = 5)
#de to er like
#res_RW1$summary.fitted.values$mean
#res_RW1$summary.linear.predictor$mean
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1$summary.fitted.values$mean))
plot_20_ARW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1",size = 5)
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1_3tau$summary.fitted.values$mean))
plot_20_ARW1_3tau <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1_3tau",size = 5)
#make all the three plots together
#RMSE
RMSE1 <- sqrt(mean((DR20_24$death_rate - res_RW1$summary.fitted.values$mean)**2))
RMSE2 <- sqrt(mean((DR20_24$death_rate - res_ARW1$summary.fitted.values$mean)**2))
RMSE3 <- sqrt(mean((DR20_24$death_rate - res_ARW1_3tau$summary.fitted.values$mean)**2))
RMSE <- c(RMSE1, RMSE2, RMSE3)
LS1 <- -mean(log(res_RW1$cpo$cpo))
LS2 <- -mean(log(res_ARW1$cpo$cpo))
LS3 <- -mean(log(res_ARW1_3tau$cpo$cpo))
LS <- c(LS1, LS2, LS3)
data <- data.frame(Method = c("RW1", "ARW1", "ARW1_3tau"), RMSE = RMSE, LS = LS)
ss <- tableGrob(data)
result_plot <- grid.arrange(plot_20_RW1, plot_20_ARW1, plot_20_ARW1_3tau, ss, nrow = 2, top = "With P = 10^5 and Gamma(1, 0.00005)")
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/res_P10^5_Gamma0.00005.pdf", plot = result_plot, height = 6, width = 8, units = "in")
P <- 1000000000
P
# Defining the model
DR20_24$us <- 1:N #adding columns for the latent models
DR20_24$time <- 1:N
P <- 1000000000
prior_str <- "Gamma0,00005" #other alternatives are Gamma0,005 and Gamma0,00005 and PC
if(prior_str == "Gamma0,00005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1")  + f(us, model = "iid")
} else if(prior_str == "Gamma0,005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "loggamma", param = c(1, 0.005))))  + f(us, model = "iid")
} else{
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "pc.prec", param = c(1, 0.01))))  + f(us, model = "iid")
}
res_RW1 <- inla(formula_RW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_RW1)
ARW1 <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model,
N = N, conflict_years = S, prior_str = prior_str)
formula_ARW1 <- death_rate ~ f(time, model = ARW1, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1 <- inla(formula_ARW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1)
ARW1_3tau <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model_3tau,
N = N, conflict_years1 = S_flu, conflict_years2 = S_WW2, prior_str = prior_str)
formula_ARW1_3tau <- death_rate ~ f(time, model = ARW1_3tau, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1_3tau <- inla(formula_ARW1_3tau, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1_3tau)
#plotting
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_RW1$summary.fitted.values$mean))
plot_20_RW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "RW1",size = 5)
#de to er like
#res_RW1$summary.fitted.values$mean
#res_RW1$summary.linear.predictor$mean
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1$summary.fitted.values$mean))
plot_20_ARW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1",size = 5)
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1_3tau$summary.fitted.values$mean))
plot_20_ARW1_3tau <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1_3tau",size = 5)
#make all the three plots together
#RMSE
RMSE1 <- sqrt(mean((DR20_24$death_rate - res_RW1$summary.fitted.values$mean)**2))
RMSE2 <- sqrt(mean((DR20_24$death_rate - res_ARW1$summary.fitted.values$mean)**2))
RMSE3 <- sqrt(mean((DR20_24$death_rate - res_ARW1_3tau$summary.fitted.values$mean)**2))
RMSE <- c(RMSE1, RMSE2, RMSE3)
LS1 <- -mean(log(res_RW1$cpo$cpo))
LS2 <- -mean(log(res_ARW1$cpo$cpo))
LS3 <- -mean(log(res_ARW1_3tau$cpo$cpo))
LS <- c(LS1, LS2, LS3)
data <- data.frame(Method = c("RW1", "ARW1", "ARW1_3tau"), RMSE = RMSE, LS = LS)
ss <- tableGrob(data)
result_plot <- grid.arrange(plot_20_RW1, plot_20_ARW1, plot_20_ARW1_3tau, ss, nrow = 2, top = "With P = 10^9 and Gamma(1, 0.00005)")
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/res_P10^9_Gamma0.00005.pdf", plot = result_plot, height = 6, width = 8, units = "in")
# Defining the model
DR20_24$us <- 1:N #adding columns for the latent models
DR20_24$time <- 1:N
P <- 1000000000
prior_str <- "Gamma0,005" #other alternatives are Gamma0,005 and Gamma0,00005 and PC
if(prior_str == "Gamma0,00005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1")  + f(us, model = "iid")
} else if(prior_str == "Gamma0,005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "loggamma", param = c(1, 0.005))))  + f(us, model = "iid")
} else{
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "pc.prec", param = c(1, 0.01))))  + f(us, model = "iid")
}
res_RW1 <- inla(formula_RW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_RW1)
ARW1 <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model,
N = N, conflict_years = S, prior_str = prior_str)
formula_ARW1 <- death_rate ~ f(time, model = ARW1, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1 <- inla(formula_ARW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1)
ARW1_3tau <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model_3tau,
N = N, conflict_years1 = S_flu, conflict_years2 = S_WW2, prior_str = prior_str)
formula_ARW1_3tau <- death_rate ~ f(time, model = ARW1_3tau, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1_3tau <- inla(formula_ARW1_3tau, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1_3tau)
#plotting
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_RW1$summary.fitted.values$mean))
plot_20_RW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "RW1",size = 5)
#de to er like
#res_RW1$summary.fitted.values$mean
#res_RW1$summary.linear.predictor$mean
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1$summary.fitted.values$mean))
plot_20_ARW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1",size = 5)
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1_3tau$summary.fitted.values$mean))
plot_20_ARW1_3tau <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1_3tau",size = 5)
#make all the three plots together
#RMSE
RMSE1 <- sqrt(mean((DR20_24$death_rate - res_RW1$summary.fitted.values$mean)**2))
RMSE2 <- sqrt(mean((DR20_24$death_rate - res_ARW1$summary.fitted.values$mean)**2))
RMSE3 <- sqrt(mean((DR20_24$death_rate - res_ARW1_3tau$summary.fitted.values$mean)**2))
RMSE <- c(RMSE1, RMSE2, RMSE3)
LS1 <- -mean(log(res_RW1$cpo$cpo))
LS2 <- -mean(log(res_ARW1$cpo$cpo))
LS3 <- -mean(log(res_ARW1_3tau$cpo$cpo))
LS <- c(LS1, LS2, LS3)
data <- data.frame(Method = c("RW1", "ARW1", "ARW1_3tau"), RMSE = RMSE, LS = LS)
ss <- tableGrob(data)
result_plot <- grid.arrange(plot_20_RW1, plot_20_ARW1, plot_20_ARW1_3tau, ss, nrow = 2, top = "With P = 10^9 and Gamma(1, 0.005)")
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/res_P10^9_Gamma0.005.pdf", plot = result_plot, height = 6, width = 8, units = "in")
# Defining the model
DR20_24$us <- 1:N #adding columns for the latent models
DR20_24$time <- 1:N
P <- 1000000000
prior_str <- "PC" #other alternatives are Gamma0,005 and Gamma0,00005 and PC
if(prior_str == "Gamma0,00005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1")  + f(us, model = "iid")
} else if(prior_str == "Gamma0,005"){
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "loggamma", param = c(1, 0.005))))  + f(us, model = "iid")
} else{
formula_RW1 <- death_rate ~ f(time, model = "rw1", hyper = list(prec = list(prior = "pc.prec", param = c(1, 0.01))))  + f(us, model = "iid")
}
res_RW1 <- inla(formula_RW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_RW1)
ARW1 <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model,
N = N, conflict_years = S, prior_str = prior_str)
formula_ARW1 <- death_rate ~ f(time, model = ARW1, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1 <- inla(formula_ARW1, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1)
ARW1_3tau <- inla.rgeneric.define(inla.rgeneric.AdaptiveRW1.model_3tau,
N = N, conflict_years1 = S_flu, conflict_years2 = S_WW2, prior_str = prior_str)
formula_ARW1_3tau <- death_rate ~ f(time, model = ARW1_3tau, extraconstr =
list(A = matrix(1, nrow = 1, ncol = N), e = 0))  + f(us, model = "iid")
res_ARW1_3tau <- inla(formula_ARW1_3tau, family = "gaussian", data = DR20_24,
control.compute = list(cpo = TRUE),
control.family = list(hyper = list(prec =
list(initial = log(P), fixed = TRUE))))
#summary(res_ARW1_3tau)
#plotting
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_RW1$summary.fitted.values$mean))
plot_20_RW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "RW1",size = 5)
#de to er like
#res_RW1$summary.fitted.values$mean
#res_RW1$summary.linear.predictor$mean
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1$summary.fitted.values$mean))
plot_20_ARW1 <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1",size = 5)
df <- cbind(DR20_24[, c("Year", "death_rate")], data.frame(eta = res_ARW1_3tau$summary.fitted.values$mean))
plot_20_ARW1_3tau <- ggplot(df, aes(Year)) +
geom_point(aes(y = death_rate, color = factor(col_map))) +
geom_line(aes(y = eta), color = "blue") +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none") +
annotate("text", x = 1960, y = max(df$death_rate), label = "ARW1_3tau",size = 5)
#make all the three plots together
#RMSE
RMSE1 <- sqrt(mean((DR20_24$death_rate - res_RW1$summary.fitted.values$mean)**2))
RMSE2 <- sqrt(mean((DR20_24$death_rate - res_ARW1$summary.fitted.values$mean)**2))
RMSE3 <- sqrt(mean((DR20_24$death_rate - res_ARW1_3tau$summary.fitted.values$mean)**2))
RMSE <- c(RMSE1, RMSE2, RMSE3)
LS1 <- -mean(log(res_RW1$cpo$cpo))
LS2 <- -mean(log(res_ARW1$cpo$cpo))
LS3 <- -mean(log(res_ARW1_3tau$cpo$cpo))
LS <- c(LS1, LS2, LS3)
data <- data.frame(Method = c("RW1", "ARW1", "ARW1_3tau"), RMSE = RMSE, LS = LS)
ss <- tableGrob(data)
result_plot <- grid.arrange(plot_20_RW1, plot_20_ARW1, plot_20_ARW1_3tau, ss, nrow = 2, top = "With P = 10^9 and PC")
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/res_P10^9_PC.pdf", plot = result_plot, height = 6, width = 8, units = "in")
res_RW1$cpo
res_RW1$cpo$failure
res_ARW1$cpo$failure
setwd("C:/Users/Halvard/Documents/GitHub/Master-project")
DeathsNorway <- read.table("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-data/DeathsNorway.txt", sep = "", header = TRUE, fill = TRUE)
PopulationNorway <- read.table("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-data/PopulationNorway.txt", sep = "", header = TRUE, fill = TRUE)
colnames(DeathsNorway)[5] <- "deaths"
NorwayData <- cbind(DeathsNorway, PopulationNorway[1:4272, "Total"]) #remove the population data for 2024 as there is no deaths data yet
colnames(NorwayData)[6] <- "population"
NorwayData$death_rate <- NorwayData$deaths/NorwayData$population
library(dplyr) #for filter and more
library(ggplot2)
library(ggpubr)
library(INLA)
library(gridExtra)
N <- 71
S_flu <- c(19, 20) # corresponds to 18, 19, the Spanish flu
S_WW2 <- c(41, 42, 43, 44, 45, 46) # corresponds to 40, ..., 45 in years, the WW2
S <- c(S_flu, S_WW2) # all shocked years
col_map <- rep(2, N) #for coloring in the plots below
col_map[S] <- 1
DR20_24 <- filter(NorwayData, Age == "20-24") |>
filter(Year >= 1900 & Year <= 1970)
plot_20 <- ggplot(DR20_24, aes(Year, death_rate, color = factor(col_map))) +
geom_point() +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none")
DR60_64 <- filter(NorwayData, Age == "60-64") |>
filter(Year >= 1900 & Year <= 1970)
plot_60 <- ggplot(DR60_64, aes(Year, death_rate, color = factor(col_map))) +
geom_point() +
labs(x = "Year", y = "Death rate") +
theme(legend.position = "none")
plot_20_60 <- ggarrange(plot_20, plot_60, ncol = 1)
death_rate_figure <- annotate_figure(plot_20_60, top = "Death rates for ages 20-24(left) and 60-64(right)")
death_rate_figure
#save the figure
#ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/death_rate_fig.pdf", plot = death_rate_figure)
#save the figure
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/death_rate_fig.pdf", plot = death_rate_figure)
death_rate_figure <- annotate_figure(plot_20_60, top = "Death rates for ages 20-24(top) and 60-64(bottom)")
death_rate_figure
#save the figure
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/death_rate_fig.pdf", plot = death_rate_figure, height = 8, width = 8, units = "in")
library(grid)
death_rate_figure <- annotate_figure(plot_20_60, top = textGrob("Death rates for ages 20-24(top) and 60-64(bottom)", gp = (gpar(fontsize = 15))))
death_rate_figure
#save the figure
ggsave("C:/Users/Halvard/Documents/GitHub/Master-project/HMD-plots/death_rate_fig.pdf", plot = death_rate_figure, height = 8, width = 8, units = "in")
